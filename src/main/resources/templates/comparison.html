<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Resultado de Comparación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .diff-added { background-color: #d4edda; }
        .diff-removed { background-color: #f8d7da; }
        .diff-changed { background-color: #fff3cd; }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Comparación: <span th:text="${comparison.schema1Name}"></span> vs <span th:text="${comparison.schema2Name}"></span></h1>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    Solo en <span th:text="${comparison.schema1Name}"></span>
                    <span class="badge bg-light text-dark" th:text="${comparison.onlyInSchema1.size}"></span>
                </div>
                <div class="card-body">
                    <ul th:if="${not comparison.onlyInSchema1.empty}">
                        <li th:each="table : ${comparison.onlyInSchema1}" th:text="${table}"></li>
                    </ul>
                    <p th:if="${comparison.onlyInSchema1.empty}">No hay tablas únicas</p>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    Solo en <span th:text="${comparison.schema2Name}"></span>
                    <span class="badge bg-light text-dark" th:text="${comparison.onlyInSchema2.size}"></span>
                </div>
                <div class="card-body">
                    <ul th:if="${not comparison.onlyInSchema2.empty}">
                        <li th:each="table : ${comparison.onlyInSchema2}" th:text="${table}"></li>
                    </ul>
                    <p th:if="${comparison.onlyInSchema2.empty}">No hay tablas únicas</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4" th:if="${not comparison.tableDifferences.empty}">
        <div class="card-header bg-warning">
            Diferencias en Tablas Comunes
        </div>
        <div class="card-body">
            <div th:each="entry : ${comparison.tableDifferences}">
                <h5 th:text="${entry.key}"></h5>
                <div th:if="${not entry.value.columnDifferences.empty}">
                    <h6>Diferencias en Columnas:</h6>
                    <ul>
                        <li th:each="diff : ${entry.value.columnDifferences}" th:text="${diff.columnName + ': ' + diff.difference}"></li>
                    </ul>
                </div>
                <div th:if="${not entry.value.indexDifferences.empty}">
                    <h6>Diferencias en Índices:</h6>
                    <ul>
                        <li th:each="diff : ${entry.value.indexDifferences}" th:text="${diff}"></li>
                    </ul>
                </div>
                <hr>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            Resumen de Esquemas
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5><span th:text="${comparison.schema1Name}"></span></h5>
                    <p>Total Tablas: <span th:text="${comparison.schema1.totalTables}"></span></p>
                    <p>Total Vistas: <span th:text="${comparison.schema1.totalViews}"></span></p>
                </div>
                <div class="col-md-6">
                    <h5><span th:text="${comparison.schema2Name}"></span></h5>
                    <p>Total Tablas: <span th:text="${comparison.schema2.totalTables}"></span></p>
                    <p>Total Vistas: <span th:text="${comparison.schema2.totalViews}"></span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header" th:classappend="${comparison.migrationAnalysis.compatible} ? 'bg-success' : 'bg-danger'">
            Análisis de Migración Oracle → PostgreSQL
            <span th:text="${comparison.migrationAnalysis.compatible} ? '✓ COMPATIBLE' : '✗ PROBLEMAS'"></span>
        </div>
        <div class="card-body">
            <p><strong>Complejidad estimada:</strong> <span th:text="${comparison.migrationAnalysis.estimatedComplexity}"></span></p>

            <div th:if="${not comparison.migrationAnalysis.compatibilityIssues.empty}">
                <h6>Problemas de Compatibilidad:</h6>
                <ul class="text-danger">
                    <li th:each="issue : ${comparison.migrationAnalysis.compatibilityIssues}" th:text="${issue}"></li>
                </ul>
            </div>

            <div th:if="${not comparison.migrationAnalysis.recommendations.empty}">
                <h6>Recomendaciones:</h6>
                <ul>
                    <li th:each="rec : ${comparison.migrationAnalysis.recommendations}" th:text="${rec}"></li>
                </ul>
            </div>

            <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse"
                    data-bs-target="#typeMappings">
                Ver Mapeo de Tipos
            </button>

            <div class="collapse mt-3" id="typeMappings">
                <div class="card card-body">
                    <h6>Mapeo de Tipos Oracle → PostgreSQL:</h6>
                    <table class="table table-sm">
                        <thead>
                        <tr>
                            <th>Columna</th>
                            <th>Mapeo</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="mapping : ${comparison.migrationAnalysis.typeMappings}">
                            <td th:text="${mapping.key}"></td>
                            <td th:text="${mapping.value}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <a href="/" class="btn btn-secondary mt-3">Volver al Inicio</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>